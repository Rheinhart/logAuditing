<!DOCTYPE html>
<html>
<head>
<title>log账单检测系统</title>
<meta name="logview" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://apps.bdimg.com/libs/bootstrap/3.2.0/css/bootstrap.min.css">
</head>
<body>
<div class="container">
<h1>log账单检测系统</h1>
<hr></hr>
<button type="button" class="btn btn-primary" id='seeklog'>实时同步今日log</button>
<button type="button" class="btn btn-warning" id='check_alllog'>重新检查全部账单</button>
<hr></hr>

<div id="list_status"> <span class="glyphicon glyphicon-search"></span> 处于waiting状态的账单: 未开始查询</div>
<hr></hr>
<table class="table table-striped table-bordered" id="logtable">
<thead>
<tr>
<th>检查</th>
<th>时间</th>
<th>补单</th>
<th>收入</th>
<th>队伍</th>
<th>预期水位</th>
<th>成交</th>
<th>赔率</th>
<th>数额</th>
<th>单号</th>
<th>状态</th>
<th>账户</th>
<th>余额</th>



</tr>
</thead>
<tbody id="logtable_body">
</tbody>
</table>
</div>

<script src="http://apps.bdimg.com/libs/jquery/1.11.1/jquery.min.js"></script>
<script>

    $(document).ready(function(){

      // 列表 list
      $('#seeklog').click(function(){
          $('#logtable_body').empty();
              $.getJSON('/ajax_refreshLog/',function(ret){
                    //返回值 ret 在这里是一个列表
                    $.each(ret, function(i, item){
                       $('#logtable_body').append(
                        "<tr id='test'>"+"<td>"+"<button type='button' style='width:40px' class='btn btn-info btn-sm' id='refresh_"+i+"' >#"+(i+1)+"</button>"+"</td>"+
                        
                        "<td>"+'ok'+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+item+"</td>"+
                        "<td>"+'Waiting'+"</td>"+
                        "<td>"+'Pinnacle CK8T720'+"</td>"+
                        "<td>"+ret[i][1]+"</td></tr>")

                        $('#refresh_'+i).click(function(){
                            $('#list_status').html(' <span class="glyphicon glyphicon-search"></span> 处于waiting状态的账单: 正在检查账单 #'+(i+1));
                            $.getJSON('/ajax_check/',function(ret){
                              $('#list_status').html(' <span class="glyphicon glyphicon-search"></span> 处于waiting状态的账单: 本账单已检查完毕');                                     
                            });                
                        });         
                    });           
                    $('#list_status').html(' <span class="glyphicon glyphicon-search"></span> 处于waiting状态的账单: 首次同步已完成')
              });    

          setInterval(function() {
              $('#logtable_body').empty();
              $.getJSON('/ajax_refreshLog/',function(ret){
                    //返回值 ret 在这里是一个列表
                    $.each(ret, function(i, item){
                       $('#logtable_body').append(
                        "<tr id='test'>"+"<td>"+"<button type='button' style='width:40px' class='btn btn-info btn-sm' id='refresh_"+i+"' >#"+(i+1)+"</button>"+"</td>"+                        
                        "<td>"+'01:50:15.3216'+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+ret[i][1]+"</td>"+
                        "<td>"+item+"</td>"+
                        "<td>"+'Waiting'+"</td>"+
                        "<td>"+'Pinnacle CK8T720'+"</td>"+
                        "<td>"+ret[i][1]+"</td></tr>")

                        $('#refresh_'+i).click(function(){
                            $('#list_status').html(' <span class="glyphicon glyphicon-search"></span> 处于waiting状态的账单: 正在检查账单: #'+(i+1));
                            $.getJSON('/ajax_check/',function(ret){
                              $('#list_status').html(' <span class="glyphicon glyphicon-search"></span> 处于waiting状态的账单: 本账单已检查完毕');                                     
                            });                
                        });         
                    });           
                    $('#list_status').html(' <span class="glyphicon glyphicon-search"></span> 处于waiting状态的账单: 实时同步已完成')
              });    
          }, 5000);     
      });           
    });
</script>
</body>
</html>

